# RabbitMQ Server Configuration for 10M Messages
# Optimized for high-throughput image processing workloads

# ============================================
# MEMORY AND PERFORMANCE SETTINGS
# ============================================

# Optimized for 96GB RAM system - use 50% for messages
vm_memory_high_watermark.relative = 0.5
vm_memory_high_watermark_paging_ratio = 0.4

# Allow massive message queues
vm_memory_calculation_strategy = allocated

# Optimize for high-throughput scenarios
heartbeat = 60
frame_max = 131072
channel_max = 2047

# ============================================
# DISK I/O OPTIMIZATION
# ============================================

# Optimize for disk I/O bound workloads (image processing)
disk_free_limit.relative = 1.2
disk_free_limit.absolute = 5GB

# Increase queue limits for massive workloads
queue_max_length = 50000000
queue_max_length_bytes = 20000000000

# Message store optimization
msg_store_file_size_limit = 16777216
msg_store_credit_disc_bound = {4000, 2000}

# Queue index optimization
queue_index_embed_msgs_below = 4096

# ============================================
# NETWORK AND CONNECTION OPTIMIZATION
# ============================================

# TCP settings for high-throughput
tcp_listen_options.backlog = 4096
tcp_listen_options.nodelay = true
tcp_listen_options.keepalive = true

# Connection pooling
connection_max = 1000

# ============================================
# CLUSTERING AND PERSISTENCE
# ============================================

# Optimize for durability vs performance
default_vhost.default_user_tags.administrator = true

# Queue durability settings
default_arguments.x-message-ttl = 86400000
default_arguments.x-expires = 604800000

# ============================================
# LOGGING AND MONITORING
# ============================================

# Reduce logging overhead for performance
log.console = false
log.file = true
log.file.level = warning

# Performance monitoring
collect_statistics_interval = 60000

# ============================================
# PLUGIN CONFIGURATION
# ============================================

# Enable management plugin for monitoring
management.tcp.port = 15672
management.tcp.ip = 0.0.0.0

# Enable prometheus plugin for metrics
prometheus.tcp.port = 15692
prometheus.tcp.ip = 0.0.0.0
